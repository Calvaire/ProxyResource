# With https://blog.tyasaka.xyz/
# ä½œè€…Telegram:  @christine_tys
mixed-port: 7890
redir-port: 7891
tproxy-port: 1536
allow-lan: true
mode: rule
geodata-mode: true
geodata-loader: standard
unified-delay: true
log-level: info
ipv6: true
external-controller: 0.0.0.0:9090
tcp-concurrent: true
enable-process: true
find-process-mode: strict
global-client-fingerprint: chrome
keep-alive-interval: 30
geo-auto-update: true
geo-update-interval: 24
geox-url:
  geoip: "https://github.com/Loyalsoldier/v2ray-rules-dat/releases/latest/download/geoip.dat"
  geosite: "https://github.com/Loyalsoldier/v2ray-rules-dat/releases/latest/download/geosite.dat"
  mmdb: "https://github.com/Loyalsoldier/v2ray-rules-dat/releases/latest/download/country.mmdb"
profile:
  store-selected: true
  store-fake-ip: true
sniffer:
  enable: true
  force-dns-mapping: true
  parse-pure-ip: true
  override-destination: true
  sniff:
    HTTP:
      ports: [80, 8080-8880]
      override-destination: true
    TLS:
      ports: [443, 8443]
    QUIC:
      ports: [443, 8443]
  force-domain:
    - "+.v2ex.com"
  skip-domain:
    - "+.mi.com"
tun:
  enable: false
  device: tun0
  stack: system
  dns-hijack:
    - "any:53"
    - "tcp://any:53"
  auto-route: true
  auto-detect-interface: true
dns:
  cache-algorithm: arc
  enable: true
  prefer-h3: true
  listen: 0.0.0.0:53
  ipv6: true
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.0/15
  fake-ip-filter:
    - "+.lan"
    - "connect.rom.miui.com"
    - "+.miwifi.com"
    - "+.ntp.org"
    - "+.u-tools.cn"
    - "+.mediatek.com"
    - "+.cfprefer1.xyz"
    - "+.wetab.link"
    # QQ
    - "localhost.ptlogin2.qq.com"
    - "localhost.sec.qq.com"
    # WeChat
    - "localhost.work.weixin.qq.com"
    - "+.weixin.qq.com"
    - "+.wechat.com"
    # Windows
    - "time.windows.com"
    - "+.msftconnecttest.com"
    - "+.msftncsi.com"
    - "+.wpsmail.net"
    - "+.henzanapp.com"
    - "+.pconline.com.cn"
  proxy-server-nameserver:
    - 8.8.8.8
  nameserver:
    - 8.8.8.8
    - 1.1.1.1
    - 119.29.29.29

# å¤„ç†ä»£ç†é›†åˆ:ipv6ä¼˜å…ˆæ¡ˆä¾‹
  p: &p
    {type: http, ip-version: ipv6-prefer , health-check: {enable: true, url: http://www.gstatic.com/generate_204, interval: 300}}
    
#	è®¢é˜…ç»„åˆ
  u: &u
    use:
    - 1.provider1
    - 2.provider2

proxy-providers:
  1.provider1:
    <<: *p  
    type: http
# èŠ‚ç‚¹æ–‡ä»¶ p1å¯¹åº”provider1
    path: ./proxy_provider/p1.yaml
# è®¢é˜… é“¾æ¥
    url: https://blog.tyasaka.xyz/
# è‡ªåŠ¨æ›´æ–°æ—¶é—´ 21600(ç§’) / 3600 = 6å°æ—¶
    interval: 21600
# èŠ‚ç‚¹åç§°å‰ç¼€ p1
    override:
      additional-prefix: "p1 |"
      
  2.provider2:
    <<: *p
    type: http
    path: ./proxy_provider/p2.yaml
    url: https://blog.tyasaka.xyz/
    interval: 21600
    override:
      additional-prefix: "p2 |"

proxy-groups:
  - {name: ğŸ¯Mode, type: select, proxies: [ğŸš€Manual, â™¨ï¸AutoSelect, â™»ï¸ SELECT1,â™»ï¸ SELECT2,â™»ï¸ SELECT3,ğŸƒDirectMode]}
  - {name: ğŸš€Manual, type: select, proxies: [], <<: *u}
  - {name: â™»ï¸ SELECT1, type: select, proxies: [ğŸš€Manual], <<: *u}
  - {name: â™»ï¸ SELECT2, type: select, proxies: [ğŸš€Manual], <<: *u}
  - {name: â™»ï¸ SELECT3, type: select, proxies: [ğŸš€Manual,ğŸƒDirectMode], <<: *u}
  - {name: ğŸ®ï¸Steam,type: select, proxies: [ğŸ¯Mode,â™»ï¸ SELECT1,â™»ï¸ SELECT2,â™»ï¸ SELECT3]}
  - {name: ğŸ’Emby,type: select, filter: "Emby", proxies: [â™»ï¸ SELECT1,â™»ï¸ SELECT2,â™»ï¸ SELECT3], <<: *u}
  - {name: ğŸªMicrosoft, type: select, proxies: [ğŸ¯Mode, â™»ï¸ SELECT1,â™»ï¸ SELECT2,â™»ï¸ SELECT3,ğŸƒDirectMode,â™¨ï¸AutoSelect]}
  - {name: ğŸ’¬Telegram, type: select, proxies: [ğŸ¯Mode, â™»ï¸ SELECT1,â™»ï¸ SELECT2,â™»ï¸ SELECT3,â™¨ï¸AutoSelect]}
  - {name: ğŸ§­Google, type: select, proxies: [ğŸ¯Mode, â™»ï¸ SELECT1,â™»ï¸ SELECT2,â™»ï¸ SELECT3]}
  - {name: ğŸFinal, type: select, proxies: [ğŸ¯Mode]}
  - {name: ğŸƒDirectMode, type: select, proxies: [DIRECT]}
  # è‡ªåŠ¨é€‰æ‹©æ¡ˆä¾‹
  - {name: â™¨ï¸AutoSelect, type: url-test, interval: 180, url: 'https://www.gstatic.com/generate_204', proxies: [], <<: *u}

rule-providers:
# è§„åˆ™ç»„åˆ
  Telegram:
    type: http
    behavior: classical
    format: yaml
    path: ./rule/Telegram.yaml
    url: "https://blog.tyasaka.xyz/beta/Telegram.yaml"
    interval: 43200
  Google:
    type: http
    behavior: classical
    format: yaml
    path: ./rule/Google.yaml
    url: "https://blog.tyasaka.xyz/beta/Google.yaml"
    interval: 43200
  Steam:
    type: http
    format: yaml
    behavior: classical
    url: "https://blog.tyasaka.xyz/beta/steam.yaml"
    path: ./rule/steam.yaml
    interval: 43200
  SteamCN: 
    type: http
    behavior: classical
    format: yaml
    url: "https://blog.tyasaka.xyz/beta/steamcn.yaml"
    path: ./rule/steamcn.yaml
    interval: 43200
  Microsoft:
    type: http
    behavior: classical
    format: yaml
    path: ./rule/Microsoft.yaml
    url: "https://blog.tyasaka.xyz/beta/Microsoft.yaml"
    interval: 43200
  RE:
    type: http
    behavior: classical
    format: yaml
    url: "https://blog.tyasaka.xyz/beta/re.yaml"
    path: ./rule/re.yaml
    interval: 43200
  Emby:
    type: http
    behavior: classical
    format: yaml
    url: "https://blog.tyasaka.xyz/beta/emby.yaml"
    path: ./rule/emby.yaml
    interval: 43200
  FCM:
    type: http
    behavior: classical
    format: yaml
    url: "https://blog.tyasaka.xyz/beta/fcm.yaml"
    path: ./rule/fcm.yaml
    interval: 43200

rules:
# - Rule Group åº”ç”¨è§„åˆ™ï¼Œä»ä¸Šå¾€ä¸‹åŒ¹é…
  - RULE-SET,SteamCN,ğŸƒDirectMode
  - RULE-SET,Google,ğŸ§­Google
  - RULE-SET,Microsoft,ğŸªMicrosoft
  - RULE-SET,Telegram,ğŸ’¬Telegram
  - RULE-SET,Steam,ğŸ®ï¸Steam
  - RULE-SET,Emby,ğŸ’Emby
  - RULE-SET,FCM,ğŸƒDirectMode
  - RULE-SET,RE,REJECT
  # GEO Rule
  - GEOSITE,CN,ğŸƒDirectMode
  - GEOIP,CN,ğŸƒDirectMode
  - MATCH,ğŸFinal
  